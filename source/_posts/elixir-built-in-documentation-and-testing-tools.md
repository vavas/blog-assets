title: Elixir's built-in documentation and testing Tools
date: 2017-08-27 18:27:48
tags:
  - elixir
  - testing
  - documentation
---

![car in a wind tunnel testing](http://i.imgur.com/6b4GmhV.jpg)
[image source](https://www.carthrottle.com/post/n43v9xq/)

One of the first and most impressive characteristics I saw when I started to study Elixir was the powerful yet simple built-in tools to help developers write documentation and tests.

A very special feature is the called `doctest`, which is a test that lives inside your documentation. With such tests, you can assure your docs are up-to-date, because whenever you run your tests, the tests inside your documentation will also be verified. **Really awesome**!

In this article I'll show you how to write a simple program with unit tests and how to document your code and generate a beautiful HTML documentation page.

Let's start!

> You can see the source code [here](https://github.com/ericdouglas/staircase).

## Specification
Our program should implement the solution for the [staircase problem](https://www.hackerrank.com/challenges/staircase).

The program will receive a positive number `n` and should print a staircase right-aligned composed of `#` symbols and spaces, with a height and width equals to `n`.

Example:

```
input > 6
output >
     #
    ##
   ###
  ####
 #####
######
```

## Creating the project
To create the project, type the following command in your terminal:

```sh terminal
mix run staircase
```

With the structure generated by mix we already can write our program and our test files. Let's now install the [ExDoc](https://github.com/elixir-lang/ex_doc) library that will generate the HTML documentation page for us.

## Installing ExDoc
Go to `mix.exs` file and add the following line inside the `deps` function:

```elixir mix.exs
defp deps do
  [
    {:ex_doc, "~> 0.16"}
  ]
end
```

Now all you need to do is run the command `mix deps.get` to install the dependency.

## Writing the tests
First we'll write some tests to make it more easy to verify if our solution is actually satisfying our specs.

To do this, go to the already created file inside the `test` folder `staircase_test.exs`.

> All test files end up with the `.exs` extension. The difference between `.ex` and `.exs` is that files with the `.exs` won't be compiled, they're *Elixir scripts*.

Let's remove the test case and add our assertions there:

```elixir test/staircase_test.exs
defmodule StaircaseTest do
  use ExUnit.Case
  import ExUnit.CaptureIO
  doctest Staircase

  test "if staircases have the right size" do
    assert capture_io(fn -> Staircase.main(1) end) == "#\n"

    assert capture_io(fn -> Staircase.main(2) end) ==
" #
##\n"

    assert capture_io(fn -> Staircase.main(3) end) ==
"  #
 ##
###\n"

    assert capture_io(fn -> Staircase.main(7) end) ==
"      #
     ##
    ###
   ####
  #####
 ######
#######\n"
  end
end
```

Don't panic! Those tests have some interesting peculiarities and it'll be a good opportunity to learn them. I know it's looking a little ugly but I hope after the explanation you'll be more comfortable with such assertions.

The first piece to note is the `import ExUnit.CaptureIO`. This module gives to us the ability to capture the output of a function so we can make an assertion to that. You can learn more about such module [here](https://hexdocs.pm/ex_unit/ExUnit.CaptureIO.html#content).

Another interesting part is the `doctest Staircase`. This tells that we will run the tests inside the documentation of the module `Staircase` together with this suit of tests.

Inside our `test` case, we can see that the `capture_io` function, from the `ExUnit.CaptureIO` module, receives an anonymous function (`fn -> end`). This is how that function works: you should pass an anonymous functions to it so it'll be called later. Check the documentation linked before to see more ways to use this function.

To finish the explanation of our tests, the string representing the output was written in the line below of our assertion because in that way the spaces before each line wouldn't broke our assertion. You can see though that Elixir allows us to write strings using multiple lines.







write about tests ok
write about function
write about moduledoc
write about comment on main
write about doc
